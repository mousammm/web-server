# listen for multiple client 

```c
while(1)
{
    int client_fd = accept(server_fd, NULL, NULL);
    char *res = ..
    send(client_fd, res, strlen(res), 0);
    close(client_fd);
};
```

* before it was listening for a single client and it close it's connection
* now it will listen for multiple client till we exit forcefully
* accept is a blocking fun it will it continue only when client connects

# get client info 

```c
while(1)
{
    socklen_t client_addr_length = sizeof(client_address);                      // address length of client 
    int client_fd = accept(server_fd, (struct sockaddr*)&client_address, &client_addr_length);
    
    // Get client info
    char client_ip[INET_ADDRSTRLEN];
    inet_ntop(AF_INET, &client_address.sin_addr, client_ip, sizeof(client_ip));      // get client ip
    int client_port = ntohs(client_address.sin_port);	                            // get client port 
    printf("client: %s:%d\n", client_ip, client_port);
    
    char *res = ..
    send(client_fd, res, strlen(res), 0);
    close(client_fd);
};
```

* before accept is taking NULL argument after chaging it we have client info
* and dont forget to declare client_address 

```c
#include <arpa/inet.h>      // inet_ntop
struct sockaddr_in address, client_address;
```

# text/html

* in res changing text/plain to text/html 
* we will hit by 2 client logs 
* First request: The browser requests your HTML page
* Second request: The browser automatically requests /favicon.ico

# getting requested path

* paste it after calling accept inside while loop

```c
// get http req
char buffer[256] = {0}; // GET /index.html ...
recv(client_fd, buffer, 256, 0);

// parse http request
char* f = buffer + 5;   // index.html ...
*strchr(f, ' ') = 0;    // index.html0...
printf("path:%s\n\n", f);
```

* client: localhost:8080/index.html
* buffer[256]: GET /index.html ...
* recv fill the client req in buffer 
* we skip the 5 char from buffer: index.html ...
* now we replace the ' ' with '\0' 
* now we could print 'f' or open a file send to client etc 

# req to res

## req

* log buffer(it holds client req)
* buffer :
```txt
GET /index.html HTTP/1.1
Host:
User-Agent:
Accept:
Content-Type:   // empty for GET req
Content-Type:   // empty for GET req
```
* this is what buffer should print 
* if u use a loop as printf print till it find a '\0'

* now we need to parse 
 - METHOD: GET
 - PATH: index.html
    * about: route 
    * index.html:
    * '/ ': default 
 - VERSION: HTTP/1.1
* the path we need to get another thing, 
* by looking at the file extension we need to determine the MIME type 
```txt
.html: text/html
.txt: text/plain
```

* NOW if you are wondering why are we even doing this 
* if to fill the response dynamically 
* we also need to implement a open_file() function

## res

* now lets talk about res we have already have implemeted 
```c
char *response = 
    "HTTP/1.1 200 OK\r\n"
    "Content-Type: text/plain\r\n"
    "Content-Length: 13\r\n"
    "\r\n"
    "Hello, World!";
```
* yeah now only difference is we need to fill it dynamically
