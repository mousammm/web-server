# req to res

```c
char* f = buffer + 5;
*strchr(f, ' ') = 0;
```

* currently we only extract path form ( GET /path HTTP/1.1)
* our goal we be to change this to a fun that store all 3 in a struct

```c
typedef struct {
    char method[16];
    char path[256];
    char version[16];
} Req_t;
```
```c
Req_t req = {0};         // local
char buffer[1024] = {0}; // gloal var 

while(;;){
    .....
    memset(buffer, 0, sizeof(buffer));  // Reset buffer for new request
    parse_req(client_fd, &req);         // path req and save in Req_t 
    .....
}
```

# int parse_req(int client_fd, Req_t* req)

```c
// read request 
int bytes_read = recv(client_fd, buffer, sizeof(buffer) - 1, 0);
if(bytes_read <= 0) return -1;
buffer[bytes_read] = '\0';

// Parse method, path, and version
char *saveptr;
char *line = strtok_r(buffer, "\r\n", &saveptr);
if (line == NULL) return -1;

// parse first line: GET /path HTTP/1.1
char *method  = strtok(line, " ");
char *path    = strtok(NULL, " ");
char *version = strtok(NULL, " ");

// Copy to struct (safe bounds-checked)
strncpy(req->method, method, sizeof(req->method) - 1);
req->method[sizeof(req->method) - 1] = '\0';

strncpy(req->path, path, sizeof(req->path) - 1);
req->path[sizeof(req->path) - 1] = '\0';

strncpy(req->version, version, sizeof(req->version) - 1);
req->version[sizeof(req->version) - 1] = '\0';

return 0;
```

# sending req

```c
char *res = 
    "HTTP/1.1 200 OK\r\n"
    "Content-Type: text/html\r\n"
    "Content-Length: 13\r\n"
    "\r\n"
    "Hello, World!";

send(client_fd, res, strlen(res), 0);
```

* now we have to make it in a fun 
* and used the Req_t to fill it values dynamically

```c
void send_res(int client_fd, Req_t* req)
{
    char res[1024] = 
        "HTTP/1.1 200 OK\r\n"
        "Content-Type: text/html\r\n"
        "Content-Length: 13\r\n"
        "\r\n"
        "Hello, World!";

    send(client_fd, res, strlen(res), 0);
}
```

* ok it goot for now we have replace it 
* but its not complete 
* like the content type now how do we get it 
* here we need MIME type or get it through file extension

# new send_res

* u see now Content-type is dynamic !!

```c
void send_res(int client_fd, Req_t* req)
{
    // Get the MIME type for the requested file
    const char* mime_type = get_mime_type(req->path);
    
    // Build HTTP response
    char response[1024];
    snprintf(response, sizeof(response),
        "HTTP/1.1 200 OK\r\n"
        "Content-Type: %s\r\n"
        "Content-Length: 13\r\n"
        "\r\n"
        "hello world",
        mime_type);

    send(client_fd, response, strlen(response), 0);
}
```

```c
const char* get_mime_type(const char* path) {
    const char *ext = strrchr(path, '.');
    if (ext == NULL) return "application/octet-stream";
    
    ext++; // skip the dot
    
    if (strcmp(ext, "html") == 0 || strcmp(ext, "htm") == 0) return "text/html";
    if (strcmp(ext, "css") == 0) return "text/css";
    if (strcmp(ext, "js") == 0) return "application/javascript";
    if (strcmp(ext, "txt") == 0) return "text/plain";
    if (strcmp(ext, "jpg") == 0 || strcmp(ext, "jpeg") == 0) return "image/jpeg";
    if (strcmp(ext, "png") == 0) return "image/png";
    if (strcmp(ext, "gif") == 0) return "image/gif";
    if (strcmp(ext, "ico") == 0) return "image/x-icon";
    if (strcmp(ext, "pdf") == 0) return "application/pdf";
    
    return "application/octet-stream";
}
```

* ok i know there is no implementation of file handling 
* but we will get to it before that 
* make it and run it 
* localhost:8080        // we get hello world it will tell to download
* localhost:8080/a.txt  // it will show hello world in txt
* localhost:8080/a.html // it will show hello world in html

## Conclusion

* it's not the file we are viewing like .txt or .html
* it the mime type that decide how we will view the file 

# NEXT FILE open!
